# Delaware Digital Static Site

## Run it locally in VS Code

0. _Install [VSCode](https://code.visualstudio.com) and [node.js](https://nodejs.org/)_
1. Execute `npm install` in the local folder
2. Start the Starter site by executing `npm run static-site` using the integrated terminal

_Note: all changes in hbs, scss and js will trigger a refresh in your browser_

## Folder structure

-   **\_partial** contains all partials, which can be shared among multiple sites
    -   **\_common** contains all partials that not change over all sites
    -   **\_mySiteName** contains all unique partials that is only used on 1 site
-   **\_data** contains all data files (JSON)
    -   **\_common** contains all data that not change over all sites
    -   **\_mySiteName** contains all unique data that is only used on 1 site
-   **\_layout** contains all layout pages with general includes like css, js, header, footer, content, ...
-   **infrastructure** contains infrastrucuture code (eg. aspx for authentication for the public site);
-   **sites** should correspond with the sites folder of the Dlw.ScBase.Website project.
    -   **mySiteName**
        -   **assets**
            -   **fonts**: all webfonts
            -   **svg**: Include the generated svg sprite file. Generated by npm "update-[site]-sprite" script.
                -   **icons**: Include all the icons needed to generate the svg sprite.
            -   **media**: all images, videos, icons
            -   **...**: create any folder, ELeventy will copy them
        -   **pages**: set of pages for components, example pages, styleguide overviews, ... which use the partials from the 'common' folder
        -   **scripts**
            -   **webpack-entry.ts** entry file for WebPack
        -   **scss**: sccs files for your themes

## Eleventy

Eleventy (11ty) is the Static Site Generator we use to output HTML files. Eleventy is a very straight forwarded tool, using Node and JavaScript, and because of that, no other dependencies are necessary. Data used in the partials, can come from front matter,
JavaScript data files that call external API's, or for template directory files.

Check out the [documentation](https://www.11ty.dev/docs/).

IMPORTANT. Note that we don't use Eleventy to setup a localhost, even though that is possible (by passing --serve to the command line). We use WebPack to initiate a BrowserSync instance. This is because our assets generated by WebPack are outputted in the 'dist' folder. Eleventy does not know there are changes there. That's the solution for now. If you don't use WebPack to generate assets, then use --serve in the command line, and remove the BrowserSync plugin in WebPack. Also make sure WebPack then outputs the assets in the watch of Eleventy (sites/siteName/assets), which will be picked up by Eleventy when there are changes.

## Templating

The starter uses Handlebars and Handlebars helpers ([additional helpers](https://github.com/helpers/handlebars-helpers)). But for your own
website, you can also use other template engines. See list of [supported template languages](https://www.11ty.dev/docs/languages/).

### Data

Eleventy's strong suit is its simplicity in which it handles data. Find out about the [data cascade](https://sia.codes/posts/architecting-data-in-eleventy/)

### Plugins

Eleventy has [several plugins](https://www.11ty.dev/docs/plugins/) for optimizing the output (eg. svg symbols, minifying and adding css inline, ...).

## SCSS Framework

We use a combination of [inuitcss](https://github.com/inuitcss/inuitcss) and our own base components. Check the Starter site for some examples.

## svg Sprite generation

By NPM script you can generate your svg sprite file automaticaly based on svg files on specific destination map.
Therefor you need to configer a config file "svg-config.json" and add an extra script for your site: "update-svg-sprite:[siteName]": "svg-sprite --config sites/[siteName]/svg-config.json sites/[siteName]/assets/svg/icons/\*.svg", .
You can genrate the svg sprite config file by going to: [documentation]http://jkphl.github.io/svg-sprite/#json.

## WebPack

We use WebPack to generate CSS and JavaScript bundles. They are outputted immediately in the 'dist' folder. The BrowserSync plugin will update the website when there are changes. Note that Eleventy is does not used as a serving tool, even though that is possible. See important note above.

## npm dependencies

There are 2 kind of dependencies:

-   devDependencies: All npm packages that are used to build the static site
-   dependencies: All npm packages that are needed by the consumer of this package

## npm scripts

-   **npm run static-site**: compiles SCSS and TS files via WebPack to 'dist.sitename/assets/', and starts the Eleventy compilation and watch. BrowserSync (added via WebPack) handes updates.
-   **npm run build-static-site**: compiles html, css and html to dist folder, ready to be served
-   **npm run update-starter-sprite**: Generate svg symbol file and html file. More settings can be find here https://github.com/jkphl/svg-sprite/blob/master/docs/command-line.md

## Setup the static site in Azure and VSO (TODO not up to date)

Follow the steps described in [https://wiki.delawareconsulting.com/display/DLWR07302/How+to+setup+a+static+clickmodel](https://wiki.delawareconsulting.com/display/DLWR07302/How+to+setup+a+static+clickmodel)

## Repository

The master repository for the Static Site can be found at [https://slnsupp-dlwr.visualstudio.com/SitecoreBase/\_git/dlw-static-site](https://slnsupp-dlwr.visualstudio.com/SitecoreBase/_git/dlw-static-site).

Copies of the Static Site included in the ScBase and EpiBase projects are integrated using [git subtrees](https://github.com/git/git/blob/master/contrib/subtree/git-subtree.txt). Information about this mechanism and how to sync with the master repository can be found [on the wiki](https://wiki.delawareconsulting.com/display/DLWR07302/Static-Site+Subtree+Usage).

# YAML for pipelines

To get the static site rolling, you need to setup 3 pipelines. They're all available in the folder .azure as .yml files for easy configuration.

-   **create-package.yml**: creates and stores a package (website.zip) that will be used by the release pipeline (cd.yml)
-   **npm-publish**: publishes a package that will be available in a feed
-   **cd.yml**: release pipeline to deploy the static site

# Setup variables

The pipelines use variables from a Variable Group that is set up in Azure Devops

1. Create a Variable group 'staticsite-release-variables' in Azure Devops > Pipelines > Library
2. Add the following variables with their correct values
    - AzureSubscriptionDev: dev environment
    - NpmPackageFeed: name of the feed
    - WebAppName: web app to deploy static site to
    - WebAppResourceGroupName: group name
3. Setup a Service Connection to GitHub.
    - Why? The cd.yml pipeline gets a script from the gitHub/delawarePro account to initiate the defaults shared between all piplines
    - Follow this procedure https://wiki.delaware.pro/pages/viewpage.action?spaceKey=DO&title=Setup+for+a+customer#Setupforacustomer-GitHub
4. Create the pipelines by selecting the .yml files
